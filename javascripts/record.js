import axios from"axios";function resetData(){dataArray=new ArrayBuffer(0),audioArray=new ArrayBuffer(0)}function broadCast(e,t){"desktop"===recordType&&chrome.tabs.query({},(function(o){o.forEach((function(o){o.id!==t&&sendMessageToTab(o.id,e)}))}))}function sendDevicesToAll(){chrome.tabs.query({},(function(e){e.forEach((function(e){sendDevicesToTab(e.id)}))}))}function sendDevicesToTab(e){var t={audios:availableAudioDevices.map((e=>({deviceId:e.deviceId,label:e.label}))),cams:availableVideoDevices.map((e=>({deviceId:e.deviceId,label:e.label}))),defaultMic:localStorage["mic-deviceId"]?localStorage["mic-deviceId"]:"default",defaultCam:localStorage["cam-deviceId"]?localStorage["cam-deviceId"]:"default"};sendMessageToTab(e,{action:"devices",data:t})}function getPremium(){return new Promise((function(e,t){chrome.cookies.get({url:baseUrl,name:"screenshot_personal_type"},(function(t){t&&"1"==t.value?e(!0):e(!1)}))}))}function getPremiumLevel(){return new Promise((function(e,t){chrome.cookies.get({url:baseUrl,name:"screenshot_personal_premium_level"},(function(t){t&&parseInt(t.value)>1?e(!0):e(!1)}))}))}function initVideo(e){socketClient&&(socketClient.active=!1),socketClient=new SocketClient(e),socketClient.connect()}function getSaveName(){if("desktop"===currentRecordType)var e="Desktop";else if("tab"===currentRecordType||"custom"===currentRecordType)e="Tab";else if("camera"===currentRecordType)e="Camera";return e+"-"+(new Date).getTime()}function getFormatName(){if("desktop"===currentRecordType||"tab"===currentRecordType||"custom"===currentRecordType)return"iuuu";if("camera"===currentRecordType){var e=new Date;return"Camera-"+(e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+"-"+e.getHours()+"-"+e.getMinutes()+"-"+e.getSeconds())}}function refreshCookie(){axios({method:"GET",url:baseUrl+"/promotion_ex"})}function goToUpgrade(e){chrome.cookies.get({url:baseUrl,name:"screenshot_personal_type"},(function(t){if(t){var o="/pricing?from="+e;openNewTab(baseUrl+o)}else{o=baseUrl+"/user/login?redirect="+baseUrl+("/pricing?from="+e);openNewTab(o)}}))}function getMicStream(e){return audioDeviceId=e,new Promise((function(t,o){window.navigator.mediaDevices.getUserMedia({audio:{deviceId:{exact:e}}}).then((function(e){t(e)})).catch((function(e){o(e)}))}))}function getVideoStream(e,t,o,n){if("1080"===localStorage.max_resolution)var r=1920,i=1080;else if("720"===localStorage.max_resolution)r=1280,i=720;else r=3840,i=2160;return new Promise((function(a,c){if("tab"==e)chrome.tabCapture.capture({audio:t,video:!0,videoConstraints:{mandatory:{chromeMediaSource:"tab",maxWidth:r,maxHeight:i}}},(function(e){if(e)a(e);else{var t=chrome.runtime.lastError.message;alert("Get tab stream error, please refresh the page and try again.",t),setDefaults()}}));else if("custom"===e)chrome.tabCapture.capture({audio:t,video:!0,videoConstraints:{mandatory:{chromeMediaSource:"tab",maxWidth:r,maxHeight:recordRatio>0?r*recordRatio:i}}},(function(e){if(e)cropStream=new CropStream2(e,recordCrop),cropStream.cropStream((function(){a(cropStream.outputStream)}));else{var t=chrome.runtime.lastError.message;alert("Get tab stream error, please refresh the page and try again.",t),setDefaults()}}));else if("desktop"==e){var d=["screen","audio"];n||d.push("window"),chooseDesktopMediaId&&(chrome.desktopCapture.cancelChooseDesktopMedia(chooseDesktopMediaId),chooseDesktopMediaId=null),chooseDesktopMediaId=chrome.desktopCapture.chooseDesktopMedia(d,(function(e){if(e){var t={audio:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:r,maxHeight:i,maxFrameRate:30}},optional:[]};window.navigator.mediaDevices.getUserMedia(t).then(a).catch(c)}else setDefaults(),window.close()}))}else"camera"==e&&getCameraStream(o,(function(e){cameraStream=e,getVideoStreamDimension(e).then((function(t){var o=t.width/t.height,n=window.screen.width,r=window.screen.height,i=parseInt(n/2),c=parseInt(i/o)+50+30;c>r-200&&(c=parseInt(.8*r),i=parseInt((c-50-30)*o)),chrome.windows.create({url:"/camera.html?type=camera",type:"popup",width:i,height:c}),a(e)}))}),(function(e){c(e)}))}))}function setBadge(e,t){"text"===e?chrome.action.setBadgeText({text:t}):"color"===e&&chrome.action.setBadgeBackgroundColor({color:t})}function doBeginRecord(e,t){setBadge("color","#E53935"),e.countdown>0?currentRecordingTabId?insertContentScript(currentRecordingTabId).then((function(){sendMessageToTab(currentRecordingTabId,{action:"startCountDown",countdown:parseInt(e.countdown)}),isInCountdown=!0,setBadge("text",_cd+""),countDownInterval=setInterval((function(){if(1==_cd)return clearInterval(countDownInterval),setBadge("text",""),_cd=0,void setTimeout((function(){gotStream(t,e)}),500);_cd--,setBadge("text",_cd+"")}),1e3)}),(function(){isInCountdown=!0,setBadge("text",_cd+""),countDownInterval=setInterval((function(){if(1==_cd)return clearInterval(countDownInterval),setBadge("text",""),_cd=0,void setTimeout((function(){gotStream(t,e)}),100);_cd--,setBadge("text",_cd+"")}),1e3)})).catch((function(e){})):(isInCountdown=!0,setBadge("text",_cd+""),countDownInterval=setInterval((function(){if(1==_cd)return clearInterval(countDownInterval),setBadge("text",""),_cd=0,void setTimeout((function(){gotStream(t,e)}),300);_cd--,setBadge("text",_cd+"")}),1e3)):gotStream(t,e)}function getStream(e){return e.isRecordMic?(audioStatus=2,sendContentMessage("updateRecordUI",{audStatus:audioStatus,camStatus:cameraStatus}),getMicStream(e.micDeviceId).then((function(t){return audioStream=t,getVideoStream(e.recordType,e.isRecordTabSound,e.camDeviceId,e.removeAppWin)}))):(audioStatus=1,sendContentMessage("updateRecordUI",{audStatus:audioStatus,camStatus:cameraStatus}),getVideoStream(e.recordType,e.isRecordTabSound,e.camDeviceId,e.removeAppWin))}function clearTemTimerSetting(){localStorage["auto-timer-stop"]=!1,localStorage["auto-hour"]="0",localStorage["auto-min"]="0",localStorage["auto-sec"]="0"}function beginRecord(e,t){currentRecordType=e.recordType,getUserSigninStatus((function(e){isSignIn=e})),isRecorded=!1,recordCrop=t||null,isBeginRecorded=!0,updateContextMenu(!0),isAutoTimerStop=e.isAutoStop,timerHour=e.autoStopHour,timerMin=e.autoStopMin,timerSec=e.autoStopSec,_cd=parseInt(e.countdown),getAllDevices().then((()=>{sendDevicesToAll()})),getStream(e).then((function(t){if(clearTemTimerSetting(),videoStream=t,videoStream.getVideoTracks()[0].onended=function(){if(audioStream&&audioStream.stop(),cameraStream&&cameraStream.stop(),socketClient){socketClient.cancel(),socketClient.needReconnect=!1,socketClient.sentQueue=[],socketClient.willSendQueue=[],socketClient.close(1e3)}currentRecordingTabId&&sendMessageToTab(currentRecordingTabId,{action:"stop-countdown"}),setDefaults()},saveStorage("recordingStatus","preparing"),recordingStatus="preparing","local"===e.saveLocation?(isSaveLocal=!0,doBeginRecord(e,videoStream)):(isSaveLocal=!1,initVideo({onopen:function(){doBeginRecord(e,videoStream)},onError:function(t){"Professional Plan Required!"===t&&(isSaveLocal=!0,doBeginRecord(e,videoStream))},onClose:function(){}}),sendMessage({action:"prepare-recording"})),("tab"===e.recordType||"custom"===e.recordType)&&e.isRecordTabSound){tabSoundAudioPlayer=new Audio;try{tabSoundAudioPlayer.srcObject=videoStream}catch(e){tabSoundAudioPlayer.src=window.URL.createObjectURL(videoStream)}tabSoundAudioPlayer.volume=1,tabSoundAudioPlayer.play()}})).catch((function(e){setDefaults(),clearTemTimerSetting();var t="",o="";if(e&&("NotAllowedError"===e.name?/Permission denied by system/.test(e)?(t="mac",/Mac OS/.test(window.navigator.userAgent)||(t="win"),/\[Mic\]/.test(e)?o="mic":"camera"===currentRecordType&&(o="camera")):/Could not start audio source/.test(e)&&(t="win",o="mic"):"NotReadableError"===e.name&&(t="mac",o="browser_issue",/Mac OS/.test(window.navigator.userAgent)||(t="win",o="mic"))),t){var n="/permission-denied.html?os="+t;o&&(n+="&type="+o),chrome.tabs.create({url:n})}}))}function handleBlob(e){if("local"===localStorage["save-location"]||isSaveLocal){if(count++,e)if(fileCreated){fileSaver.append(e,currentSaveName),currentSize+=e.size;var t=bytesToSize(currentSize);currentInfo.detail.size=t,currentInfo.detail.duration=recordingTime,DB.update(currentId,currentInfo)}else currentName=getFormatName(),currentSaveName=getSaveName(),fileSaver.save(e,currentSaveName).then((function(t){fileCreated=!0,currentSize=e.size,tempFileInfo={fileUrl:t,title:currentName,size:bytesToSize(currentSize),duration:recordingTime,recordType:currentRecordType},DB.save(tempFileInfo).then((function(e){currentId=e.id,currentInfo=e}))}))}else socketClient.send(e)}function getVideoStreamDimension(e){return new Promise((function(t,o){var n=document.createElement("video");n.srcObject=e,n.onloadedmetadata=function(){t({width:n.videoWidth,height:n.videoHeight})}}))}function getBitRate(e,t){return Math.floor(e*t*2)}function gotStream(e,t){if(e&&e.active){sendContentMessage("done_start",{}),isRecorded=!0;var o={type:"video",disableLogs:!1,getNativeBlob:!0,timeSlice:"local"===localStorage["save-location"]||isSaveLocal?3e3:500,ondataavailable:handleBlob};if(!o.videoCodec)var n="vp8";if(n&&(o.mimeType="video/webm; codecs="+n.toLowerCase()),audioStream||e.getAudioTracks().length>0){var r=new MediaStream;(i=getMixedAudioStream([audioStream,e])).getAudioTracks().forEach((function(e){r.addTrack(e)})),e.getVideoTracks().forEach((function(e){r.addTrack(e)})),e=r}else{r=new MediaStream;audioContext=new AudioContext,gainNode=audioContext.createGain(),audioDestination=audioContext.createMediaStreamDestination(),audioContext.createMediaElementSource(document.createElement("audio")).connect(audioDestination);var i=audioDestination.stream;window.mixedAudioStream=i,e.getVideoTracks().forEach((function(e){r.addTrack(e)})),i.getAudioTracks().forEach((function(e){r.addTrack(e)})),e=r}recorder=new RecordRTC(e,o);try{recorder.startRecording(),sendMessage({action:"start-recording"}),alreadyHadGUMError=!1}catch(e){}isRecording=!0,saveStorage("recordingStatus","recording"),recordingStatus="recording",videoStream.onended=function(e,t){videoStream&&(videoStream.onended=function(){}),audioStream&&audioStream.stop(),cameraStream&&cameraStream.stop(),cropStream&&(cropStream.stop(),cropStream=null,sendContentMessage("endSelect",{})),stopScreenRecording(e,t)},videoStream.getVideoTracks()[0].onended=function(e){videoStream&&videoStream.onended&&videoStream.onended()},audioStream&&audioStreamStatusMonitor(audioStream),recordingStartTime=(new Date).getTime(),recordingTimer=setInterval(updateRecordingTime,100)}}function audioStreamStatusMonitor(e){e&&(offlineMicIssue=!1,e.getAudioTracks()[0].onended=function(){isRecording&&"live"===videoStream.getVideoTracks()[0].readyState&&(handleAudioDeviceOffline(),e.onended=null)})}function handleAudioDeviceOffline(){isRecording&&getMicStream("default").then((function(e){if(e){if(audioStream=e,gainNode&&audioDestination){var t=audioContext.createMediaStreamSource(e);t.connect(gainNode),t.connect(audioDestination)}}else isRecording&&videoStream&&"live"==videoStream.getVideoTracks()[0].readyState&&(offlineMicIssue=!0)}),(function(){isRecording&&videoStream&&"live"==videoStream.getVideoTracks()[0].readyState&&(offlineMicIssue=!0)}))}function updateAutoTimer(e,t,o){timerHour=e,timerMin=t,timerSec=o,isAutoTimerStop=!0,resetTimer()}function updateAutoTimerValue(e,t){switch(e){case"hour":1e3*(timerSec+60*timerMin+60*t*60)>recordTimeLength-startAutoStop&&(timerHour=t);break;case"min":1e3*(timerSec+60*t+60*timerHour*60)>recordTimeLength-startAutoStop&&(timerMin=t);break;case"sec":1e3*(t+60*timerMin+60*timerHour*60)>recordTimeLength-startAutoStop&&(timerSec=t)}}function checkTimeLength(e){"cloud"!==localStorage["save-location"]||isSaveLocal||isAutoTimerStop&timerHour+timerMin+timerSec>0||getPremiumLevel().then((function(t){t||e>=108e5*twoHoursCount&&e<=108e5*twoHoursCount+100&&(chrome.windows.create({type:"popup",url:"/notification.html",left:0,top:0,width:300,height:400,focused:!0}),twoHoursCount++)})),e>=301e3&&chrome.storage.local.get("userinfo",(function(e){e.userinfo?"local"===localStorage["save-location"]||isSaveLocal?e.userinfo.premiumLevel<2&&(1===e.userinfo.premiumLevel&&0===e.userinfo.newPremium||stopStream(!1,!0)):e.userinfo.videoTotalLimitation>=e.userinfo.videoLimitation&&e.userinfo.premiumLevel<2&&stopStream(!1,!0):stopStream(!1,!0)})),isAutoTimerStop&timerHour+timerMin+timerSec>0&&e-startAutoStop>=1e3*(timerSec+60*timerMin+60*timerHour*60+.9)&&stopStream(!1,!1)}function getMixedAudioStream(e){audioContext=new AudioContext;var t=[];gainNode=audioContext.createGain(),gainNode.connect(audioContext.destination),gainNode.gain.value=0;var o=0;if(e.forEach((function(e){if(e){if(!e.getAudioTracks().length)return;o++;var n=audioContext.createMediaStreamSource(e);n.connect(gainNode),t.push(n),e===audioStream&&(audioSource_=n)}})),o)return audioDestination=audioContext.createMediaStreamDestination(),t.forEach((function(e){e.connect(audioDestination)})),audioDestination.stream}function resetTimer(){startAutoStop=recordTimeLength}function resetToolbarSettings(){toolbarSettings={mouseMode:"mouse",currentMouse:"default",drawMode:"freeline",currentColor:"red",isCollapse:!1,isPaused:!1}}function updateAutoStop(e){isAutoTimerStop=e,e||(timerHour=0,timerMin=0,timerSec=0,startAutoStop=0)}function getAutoStopTime(){if(isAutoTimerStop&&timerHour+timerMin+timerSec>0){var e=1e3*(timerSec+60*timerMin+60*timerHour*60),t=recordTimeLength-startAutoStop,o=0;e>=t&&(o=e-t),o=Math.ceil(o/1e3);var n=Math.floor(o/3600),r=Math.floor((o-3600*n)/60),i=o%60;i<10&&(i="0"+i),autoStopTime=(n>0?n+":":"")+r+":"+i}}function updateRecordingTime(){if(!isRecordingPaused){var e=(new Date).getTime()-recordingStartTime;pausedTime&&(e-=pausedTime),recordTimeLength=e,checkTimeLength(e),recordingTime=secondsToTime(e),getAutoStopTime(),setBadge("text",recordingTime),"desktop"!==recordType&&"tab"!==recordType&&"custom"!==recordType||sendMessageToTab(("tab"===recordType||recordType,currentRecordingTabId),{action:"updateRecordTime",data:recordingTime})}}function secondsToTime(e){e=Math.floor(e/1e3);var t=Math.floor(e/3600),o=e%60;return o<10&&(o="0"+o),(t>0?t+":":"")+Math.floor((e-3600*t)/60)+":"+o}function setDefaults(){currentRecordingTabId&&(sendMessageToTab(currentRecordingTabId,{action:"removeRecordDiv"}),sendMessageToTab(currentRecordingTabId,{action:"endSelect"})),videoStream&&(videoStream.getTracks().forEach((function(e){e.stop()})),videoStream.onended&&videoStream.onended()),updateContextMenu(!1),recordOptions.isShowToolbar&&(resetToolbarSettings(),stopToolbar()),tabSoundAudioPlayer=null,audioStream&&audioStream.stop(),cameraStream&&stopCamera(),countDownInterval&&(clearInterval(countDownInterval),countDownInterval=null),isBeginRecorded=!1,recorder=null,videoStream=null,audioStream=null,isRecording=!1,recordingStatus="",saveStorage("recordingStatus",""),recordingStartTime=null,recordingTime=0,tempFileInfo=null,imgIndex=0,isRecordingPaused=!1,isAnnotated=!1,isRecorded=!1,cameraPreviewOpened=!1,_cd=0,isInCountdown=!1,currentId=null,tempFileInfo=null,currentSize=null,currentName=null,currentSaveName=null,fileCreated=!1,currentInfo=null,twoHoursCount=1,isEmbedCamera=!1,isShowToolbar=!1,clearInterval(recordingTimer),recordingTimer=null,lastPausingTime=null,pausedTime=null,audioContext&&audioContext.close(),audioContext=null,currentRecordingTabId="",currentRecordingTabTitle="",tabCameraClosedManually=!1,audioContext=null,gainNode=null,audioDestination=null,offlineMicIssue=!1,audioStatus=1,cameraStatus=1,setBadge("text",""),timerHour=0,timerMin=0,timerSec=0,startAutoStop=0,recordTimeLength=0,isAutoTimerStop=!1,autoStopTime="",customRecordOption=null}function pauseScreenRecording(e,t){isRecordingPaused||("local"===localStorage["save-location"]||isSaveLocal||socketClient.pause(e,t),recorder.pauseRecording(),isShowToolbar&&("tab"===recordType||"custom"===recordType?currentRecordingTabId&&sendMessageToTab(currentRecordingTabId,{action:"pause"}):"desktop"===recordType&&broadCast({action:"pause"})),"camera"===recordType&&sendMessage({action:"pause-recording"}),isRecordingPaused=!0,lastPausingTime=(new Date).getTime())}function resumeScreenRecording(){"local"===localStorage["save-location"]||isSaveLocal||"connected"===socketClient.status?(recorder.resumeRecording(),isShowToolbar&&("tab"===recordType||"custom"===recordType?sendMessageToTab(currentRecordingTabId,{action:"resume"}):"desktop"===recordType&&broadCast({action:"resume"})),"camera"===recordType&&sendMessage({action:"record/resume"}),isRecordingPaused=!1,pausedTime=pausedTime+(new Date).getTime()-lastPausingTime):socketClient.reConnect()}function stopStream(e,t){videoStream&&(videoStream.onended?videoStream.onended(e,t):videoStream.getVideoTracks()[0].onended())}function restoreRecording(){isRecording=!1,recordingStatus="",saveStorage("recordingStatus",""),clearInterval(recordingTimer),recordingTimer=null,lastPausingTime=null,pausedTime=null,currentRecordingTabId="",tabCameraClosedManually=!1,setBadge("text",""),videoStream&&videoStream.getTracks().forEach((function(e){e.stop()}))}function stopScreenRecording(e,t){recorder.stopRecording((function(){if(googleEvent("record video","record video"),cameraStream&&stopCamera(),"local"===localStorage["save-location"]||isSaveLocal)e?DB.delete(currentId):openNewTab("/video-react.html?id="+currentId);else{if(e){var o=socketClient.videoName.match(/-(.*)\.webm/)[1];socketClient.cancel(),socketClient.needReconnect=!1,socketClient.sentQueue=[],socketClient.willSendQueue=[],socketClient.close(1e3)}else if(socketClient.complete(),openNewTab(socketClient.videoURI+(t?"?limit=true":"")),socketClient.videoName){o=socketClient.videoName.match(/-(.*)\.webm/)[1];SocketClient.httpClickStop(o)}}setDefaults(),sendMessage({action:"stop-recording"}),refreshUserInfo()})),recordingTimer&&clearTimeout(recordingTimer)}function changeAudioId(e){e!==audioDeviceId&&videoStream&&"live"==videoStream.getVideoTracks()[0].readyState&&(audioStream&&(audioStream.stop(),audioStream=null),connectAudio(e))}function sendStatusToTab(){}function toggleToolbar(){"camera"!==recordType&&(isShowToolbar?stopToolbar():initToolbar())}function toggleMic(){if(audioStream)audioStream.stop(),audioStream=null,sendMessage({action:"updateRecordUI"}),audioStatus=1,sendContentMessage("updateRecordUI",{audStatus:audioStatus,camStatus:cameraStatus});else{var e=localStorage["mic-deviceId"];e||(e="default"),connectAudio(e)}}function sendContentMessage(e,t){"desktop"===recordType?broadCast({action:e,data:t}):"tab"!==recordType&&"custom"!==recordType||currentRecordingTabId&&sendMessageToTab(currentRecordingTabId,{action:e,data:t})}function connectAudio(e){getMicStream(e).then((function(e){if(e){if(audioStream=e,gainNode&&audioDestination){var t=audioContext.createMediaStreamSource(e);t.connect(gainNode),t.connect(audioDestination)}sendMessage({action:"updateRecordUI"}),audioStatus=2,sendContentMessage("updateRecordUI",{audStatus:audioStatus,camStatus:cameraStatus})}}),(function(e){audioStatus=3,sendContentMessage("updateRecordUI",{audStatus:audioStatus,camStatus:cameraStatus}),"NotAllowedError"===e.name&&openNewTab("/getAccess.html")}))}function stopToolbar(){"desktop"===recordType?chrome.tabs.query({},(function(e){e.forEach((function(e){sendMessageToTab(e.id,{action:"remove-toolbar"})}))})):"tab"!==recordType&&"custom"!==recordType||currentRecordingTabId&&sendMessageToTab(currentRecordingTabId,{action:"remove-toolbar"}),isShowToolbar=!1,sendMessage({action:"updateRecordUI"})}function getFileSize(e){var t=(e/1024).toFixed(2);return t=t<1024?t.toString().replace(",",".").replace(/\d{1,3}(?=(\d{3})+(?!\d))/g,"$&,")+" KB":(t=(t/1024).toFixed(2)).toString().replace(",",".").replace(/\d{1,3}(?=(\d{3})+(?!\d))/g,"$&,")+" MB"}function saveVideo(){var e="AwesomeScreenshot-"+(new Date).toLocaleString().replace(/\s/g,""),t=(new File([recorder.getBlob()],e+".webm",{type:"video/webm"}),recorder.getBlob()),o=bytesToSize(t.size);fileSaver.save(t,e+".webm").then((function(t){DB.save({fileUrl:t,title:e,size:o,duration:recordingTime}).then((function(e){chrome.runtime.sendMessage({name:"stop"},(function(){chrome.tabs.create({url:"/video.html?id="+e}),setDefaults()}))}))}))}function getClientStr(){return/Edg/.test(navigator.userAgent)?"Edge extension":"Chrome extension"}function googleEvent(e,t){"undefined"!=typeof ga&&ga("send","event",getClientStr().toLowerCase(),e,t)}function getOS(){window.navigator.userAgent;var e=window.navigator.platform,t=null;return-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(e)?t="Mac OS":-1!==["Win32","Win64","Windows","WinCE"].indexOf(e)?t="Windows":!t&&/Linux/.test(e)&&(t="Linux"),t}function waitForCameraPreview(e){cameraPreviewOpened&&e();var t=setInterval((function(){cameraPreviewOpened&&(clearInterval(t),e())}),1e3)}function getAllDevices(){return new Promise((function(e,t){getAllAudioVideoDevices((function(t){var o=t;availableAudioDevices=getDevices(o.audioInputDevices),availableVideoDevices=getDevices(o.videoInputDevices),e()}))}))}function getDevices(e){return e.filter((function(e,t,o){return""!==e.label&&o.findIndex((function(t){return t.deviceId===e.deviceId}))===t}))}window.getMicFrame=null,window.audioStream=null,window.cameraStream=null,window.videoStream=null,window.tempVideo=null,window.MIME_TYPE="video/webm",window.file_name="/awesome/record.webm",window.chooseDesktopMediaId=null,window.currentId=null,window.tempFileInfo=null,window.currentSize=null,window.currentName=null,window.currentSaveName=null,window.fileCreated=!1,window.currentInfo=null,window.isAnnotated=!1,window.isRecorded=!1,window.twoHoursCount=1,window.isRecording=!1,window.isBeginRecorded=!1,window.recordingStatus="",window.isRecordingPaused=!1,window.recordingTime=0,window.recordingTimer=null,window.lastPausingTime=null,window.pausedTime=null,window.recoder=null,window.currentRecordType="",window.tabSoundAudioPlayer=null,window.isPremium=!1,window.recordingStartTime=null,window.count=0,window._cd=0,window.isInCountdown=!1,window.cameraPreviewOpened=!1,window.socketClients=[],window.socketClient=null,window.countDownInterval=null,window.audioDestination,window.gainNode,window.offlineMicIssue=!1,window.audioContext,window.audioDeviceId="",window.audioSource_=null,window.recordStream=null,window.cropStream=null,window.availableAudioDevices=[],window.availableVideoDevices=[],window.audioStatus=1,window.cameraStatus=1,window.isSaveLocal=!1,window.recordCrop=null,window.isAutoTimerStop=!1,window.timerHour=timerMin=timerSec=0,window.recordTimeLength=0,window.autoStopTime="",window.startAutoStop=0,window.baseUrl="https://www.awesomescreenshot.com",chrome.cookies.get({url:baseUrl,name:"screenshot_personal_type"},(function(e){void 0===e&&refreshCookie()})),DB.init(),window.addEventListener("message",(function(e){"audioStream"==e.data.type&&(audioStream=e.data.steam)}),!1),navigator.mediaDevices.ondevicechange=function(e){navigator.mediaDevices.enumerateDevices().then((function(e){var t=!1;e.forEach((function(e){"audioinput"===e.kind&&(t=!0)})),t&&offlineMicIssue&&isRecording&&videoStream&&"live"==videoStream.getVideoTracks()[0].readyState&&(offlineMicIssue=!1,handleAudioDeviceOffline())}))},chrome.commands.onCommand.addListener((function(e){"pause-or-resume-recording"===e?isRecording&&(isRecordingPaused?resumeScreenRecording():pauseScreenRecording()):"start-or-stop-recording"===e&&(isRecording?stopStream():isBeginRecorded||getCurrentTab((function(e){isNotAcceptedTab(e.url)||(currentRecordingTabId=e.id),getUserSigninStatus((function(e){prepareContextRecord("desktop",e)}))})))}));