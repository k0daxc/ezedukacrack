var Bg=chrome.extension.getBackgroundPage(),camDevices=[],baseURL="https://www.awesomescreenshot.com",isSignIn=!1,meter=null,rafID=null,volumeStream=null,premiumLevel=0,newPremium=!1,isAllowVa=null,allowUploadImage=!1,allowVideoCreate=!1,imageLimitation=100,imageTotalLimitation=0,videoLimitation=20,videoTotalLimitation=0,prepareInterval=null,isFileUrl=!1,isAllowContentJs=!0,fileAllowedAccess=!1,mediaDevices=null,haveAudioDevices=!1,haveVideoDevices=!1,isAllowedMic=!1,isAllowedCam=!1,availableAudioDevices=[],availableVideoDevices=[],init=!1,isGetUserInfo=!1,haveSetDefaultTab=!1,isAutoRecordTab=!1;let recordTabId="",recordType="",openType="",lastTabId="",recordWinId="",options={};function saveStorage(e,i,o){chrome.storage.local.set({[e]:i},o)}async function getStorage(e){return await new Promise((i=>{e?chrome.storage.local.get([e],(o=>{i(o[e])})):chrome.storage.local.get(null,(e=>{i(e)}))}))}i18n();let recordingTimer=null;async function initPopup(){const e=await getStorage();options=e.options;const i=e.recordingInfo;recordSettings=e.recordSettings,options["dark-mode"]&&$("body").addClass("dark-mode"),(!i||"recording"!==i.status&&"preparing"!==i.status)&&chrome.cookies.getAll({url:baseURL},(function(e){if(chrome.runtime.lastError,e){for(var i=0,o=e.length;i<o;i++)if("screenshot_personal_fullname"===e[i].name)var a=decodeURI(e[i].value);else if("screenshot_personal_type"===e[i].name)var t=e[i].value;else if("screenshot_personal_premium_level"===e[i].name)var n=e[i].value;else if("screenshot_personal_permission"===e[i].name)e[i].value.split(",");else if("screenshot_personal_uid"===e[i].name)var r=e[i].value;a?(isSignIn=!0,$(".aws-info").find(".user-name").text(a).attr("title",a),$("#no-signin").hide(),$("#aws-account").show(),chrome.storage.local.get("userinfo",(function(e){e.userinfo&&(premiumLevel=parseInt(n),newPremium=e.userinfo.newPremium,allowUploadImage=e.userinfo.allowUploadImage,allowVideoCreate=e.userinfo.allowVideoCreate,imageLimitation=e.userinfo.imageLimitation,imageTotalLimitation=e.userinfo.imageTotalLimitation,videoLimitation=e.userinfo.videoLimitation,videoTotalLimitation=e.userinfo.videoTotalLimitation,localStorage.videoTotalLimitation=videoTotalLimitation,isGetUserInfo=!0,chrome.storage.local.set({userinfo:{newPremium:e.userinfo.newPremium,uid:e.userinfo.uid,premiumLevel:parseInt(n),allowUploadImage:e.userinfo.allowUploadImage,allowVideoCreate:e.userinfo.allowVideoCreate,imageLimitation:e.userinfo.imageLimitation,imageTotalLimitation:e.userinfo.imageTotalLimitation,videoLimitation:e.userinfo.videoLimitation,videoTotalLimitation:e.userinfo.videoTotalLimitation}}),updateSavePlace()),$("#loading").addClass("active"),$.ajax({method:"GET",url:baseURL+"/api/v1/user/einfo"}).done((function(e){premiumLevel=parseInt(e.data.premiumLevel),newPremium=e.data.newPremium,allowUploadImage=e.data.permission.allowUploadImage,allowVideoCreate=e.data.permission.allowVideoCreate,imageLimitation=e.data.counts.imageLimitation,imageTotalLimitation=e.data.counts.imageTotalLimitation,videoLimitation=e.data.counts.videoLimitation,videoTotalLimitation=e.data.counts.videoTotalLimitation,localStorage.videoTotalLimitation=videoTotalLimitation,isGetUserInfo=!0,chrome.storage.local.set({userinfo:{newPremium,uid:r,premiumLevel,allowUploadImage,allowVideoCreate,imageLimitation,imageTotalLimitation,videoLimitation,videoTotalLimitation}}),$("#loading").removeClass("active"),updateSavePlace(),setTimeout((function(){$(document.body).removeClass("no-transition")}),500)})).catch((function(e){$("#loading").addClass("hide"),setTimeout((function(){$(document.body).removeClass("no-transition")}),500)}))}))):(isGetUserInfo=!0,chrome.storage.local.remove("userinfo"),"local"===localStorage["save-location"]&&showLimit(),$("#loading").addClass("hide"),$("#no-signin").show(),$("#aws-account").hide(),updateSavePlace()),"0"==t?$(".aws-user").removeClass("premium"):void 0===t?($(".aws-premium-icon").hide(),$(".aws-upgrade").hide()):$(".aws-user").addClass("premium"),isSignIn||setSaveLocal()}})),i&&"recording"===i.status&&(switchView("recording-view"),updateRecordUI(),Bg.isRecordingPaused&&(updatePausedUI(!0),Bg.socketClient&&Bg.socketClient.paused&&$("#recording-error").show()),recordingTimer=setInterval(updateTime,100)),i&&"preparing"===i.status&&(Bg.isInCountdown?switchView("video-countdown-view"):switchView("video-prepare-view"),prepareInterval=setInterval((function(){i&&"recording"===i.status?(switchView("recording-view"),clearInterval(prepareInterval),prepareInterval=null,recordingTimer=setInterval(updateTime,100)):Bg.isInCountdown&&$("#countdown-num").text(Bg._cd)}),100))}function sendMessageToTab(e,i,o){chrome.tabs.sendMessage(e,i,o)}function getCurrentTab(e,i){chrome.tabs.query(Object.assign({active:!0},e),(function(e){i(e[0])}))}initPopup(),getCurrentTab({currentWindow:!0},(function(e){sendMessageToTab(e.id,{action:"check-videos"})})),localStorage.popupTab,chrome.windows.getCurrent((function(e){getCurrentTab({windowId:e.id},(function(i){chrome.action.getBadgeText({tabId:i.id},(function(i){"New"==i&&(chrome.action.setBadgeText({text:""}),chrome.tabs.create({url:"https://blog.awesomescreenshot.com/2022/02/15/workspace-a-collaborative-visual-repository-for-your-team/"}),localStorage.newClickVersion=Bg.newClickVersion,e.close())}))}))})),!localStorage.capture_desktop||localStorage.capture_desktop,$("#show-advanced").on("click",(function(){$("#advanced-option-container").is(":visible")?$(this).removeClass("hide").find("span").text("Show Advanced Options"):$(this).addClass("hide").find("span").text("Hide Advanced Options"),$("#advanced-option-container").toggle()})),chrome.runtime.connect({name:"popup"});